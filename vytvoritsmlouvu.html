<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vytvo≈ôit pracovn√≠ smlouvu</title>
  <link rel="stylesheet" href="css/style.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    .wide { max-width: 900px; margin: auto; }
    .hidden { display: none; }
    .smlouva-vystup {
      background: #fff;
      padding: 20px;
      border: 1px solid #ccc;
      margin-top: 20px;
      white-space: normal;
    }
    #smlouvaFinalHTML h2, h3 { margin-top: 1em; }
  </style>
</head>
<body>
  <div class="container wide">
    <h1>Vytvo≈ôit pracovn√≠ smlouvu</h1>

    <form id="smlouvaForm">
      <label>Zhotovitel:</label>
      <input type="text" id="zhotovitel" required />

      <label>Objednatel:</label>
      <input type="text" id="objednatel" required />

      <label>P≈ôedmƒõt pr√°ce:</label>
      <input type="text" id="prace" required />

      <label>Cena:</label>
      <input type="text" id="cena" required />

      <label>Datum zah√°jen√≠:</label>
      <input type="date" id="datumOd" required />

      <label>Datum dokonƒçen√≠:</label>
      <input type="date" id="datumDo" required />

      <label>Pozn√°mky:</label>
      <textarea id="poznamky"></textarea>

      <h3>Voliteln√© podm√≠nky:</h3>
      <label><input type="checkbox" id="zaskrtnoutVse" /> Za≈°krtnout v≈°echny</label><br />
      <label><input type="checkbox" class="klauzule" value="elektrina" /> Objednatel zajist√≠ elektriku</label><br />
      <label><input type="checkbox" class="klauzule" value="voda" /> Objednatel zajist√≠ vodu</label><br />
      <label><input type="checkbox" class="klauzule" value="hygiena" /> Objednatel zajist√≠ hygienick√© z√°zem√≠</label><br />
      <label><input type="checkbox" class="klauzule" value="pristup" /> Objednatel zajist√≠ p≈ô√≠stup ke stavbƒõ</label><br />
      <label><input type="checkbox" class="klauzule" value="pokuta" /> Smluvn√≠ pokuta za prodlen√≠</label><br />
      <label><input type="checkbox" class="klauzule" value="odstoupeni" /> Pokuta za neopr√°vnƒõn√© odstoupen√≠</label><br />
      <label><input type="checkbox" class="klauzule" value="skoda" /> N√°hrada ≈°kody</label><br />
      <label><input type="checkbox" class="klauzule" value="uklid" /> Poplatek za √∫klid</label><br />
      <label><input type="checkbox" class="klauzule" value="zaruka" /> Z√°ruka na d√≠lo</label><br />
      <label><input type="checkbox" class="klauzule" value="mlcenlivost" /> Mlƒçenlivost</label><br /><br />

      <label>Zadejte e-mail objednatele:</label>
      <input type="email" id="email" placeholder="nap≈ô. zakaznik@email.cz" /><br /><br />

      <button type="submit">Vytvo≈ôit pracovn√≠ smlouvu</button><br /><br />
      <button type="button" onclick="zpetNaHlavni()">Zpƒõt na hlavn√≠ str√°nku</button>
      <button type="button" onclick="dalsiKrok('predavaciprotokol.html')">Dal≈°√≠ krok</button>
    </form>

    <div id="vystupSmlouvy" class="smlouva-vystup hidden">
      <div id="smlouvaFinalHTML"></div><br />
      <button onclick="stahnoutPDF()">üìÑ St√°hnout jako PDF</button>
      <button onclick="odeslatEmailem()">‚úâÔ∏è Odeslat e-mailem</button>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const ulozenyZakaznik = JSON.parse(localStorage.getItem("ulozenyZakaznik"));
      if (ulozenyZakaznik) {
        document.getElementById("objednatel").value = ulozenyZakaznik.name;
      }

      document.getElementById("zaskrtnoutVse").addEventListener("change", function () {
        document.querySelectorAll(".klauzule").forEach((checkbox) => {
          checkbox.checked = this.checked;
        });
      });

      document.getElementById("smlouvaForm").addEventListener("submit", function (e) {
        e.preventDefault();

        const z = document.getElementById("zhotovitel").value;
        const o = document.getElementById("objednatel").value;
        const p = document.getElementById("prace").value;
        const c = document.getElementById("cena").value;
        const od = document.getElementById("datumOd").value;
        const do_ = document.getElementById("datumDo").value;
        const poz = document.getElementById("poznamky").value;
        const klauzule = Array.from(document.querySelectorAll(".klauzule:checked")).map(el => el.value);

        let podminkyHTML = "";
        if (klauzule.includes("elektrina")) podminkyHTML += "<li>Objednatel zajist√≠ p≈ô√≠vod elektrick√© energie.</li>";
        if (klauzule.includes("voda")) podminkyHTML += "<li>Objednatel zajist√≠ p≈ô√≠stup k vodƒõ.</li>";
        if (klauzule.includes("hygiena")) podminkyHTML += "<li>Objednatel zajist√≠ hygienick√© z√°zem√≠ pro pracovn√≠ky.</li>";
        if (klauzule.includes("pristup")) podminkyHTML += "<li>Objednatel umo≈æn√≠ p≈ô√≠stup ke stavbƒõ.</li>";
        if (klauzule.includes("pokuta")) podminkyHTML += "<li>Smluvn√≠ pokuta za prodlen√≠ s platbou: 0,05 % dennƒõ.</li>";
        if (klauzule.includes("odstoupeni")) podminkyHTML += "<li>Pokuta za neopr√°vnƒõn√© odstoupen√≠: 30 % z ceny neproveden√Ωch prac√≠.</li>";
        if (klauzule.includes("skoda")) podminkyHTML += "<li>N√°hrada ≈°kody zp≈Øsoben√© zma≈ôen√≠m zak√°zky.</li>";
        if (klauzule.includes("uklid")) podminkyHTML += "<li>√öƒçtov√°n poplatek za √∫klid, pokud nebude zaji≈°tƒõn.</li>";
        if (klauzule.includes("zaruka")) podminkyHTML += "<li>Z√°ruka na d√≠lo: 24 mƒõs√≠c≈Ø.</li>";
        if (klauzule.includes("mlcenlivost")) podminkyHTML += "<li>Obƒõ strany se zavazuj√≠ k mlƒçenlivosti.</li>";

        const smlouvaHTML = `
<h2>SMLOUVA O D√çLO</h2>
<h3>I. Smluvn√≠ strany</h3>
<p><strong>Zhotovitel:</strong> ${z}</p>
<p><strong>Objednatel:</strong> ${o}</p>

<h3>II. P≈ôedmƒõt smlouvy</h3>
<p>Zhotovitel se zavazuje prov√©st pro objednatele n√°sleduj√≠c√≠ pr√°ce: <strong>${p}</strong>.</p>

<h3>III. Cena d√≠la</h3>
<p>Sjednan√° cena za d√≠lo: <strong>${c}</strong>.</p>

<h3>IV. Term√≠n plnƒõn√≠</h3>
<p>Zah√°jen√≠: <strong>${od}</strong> | Dokonƒçen√≠: <strong>${do_}</strong></p>

<h3>V. Dopl≈àuj√≠c√≠ pozn√°mky</h3>
<p>${poz || "≈Ω√°dn√©."}</p>

<h3>VI. Smluvn√≠ podm√≠nky</h3>
<ul>${podminkyHTML || "<li>Bez zvl√°≈°tn√≠ch podm√≠nek</li>"}</ul>

<h3>VII. Datum a podpisy</h3>
<p>Datum: ${new Date().toLocaleDateString()}</p>
<p><br>________________________ Zhotovitel<br>________________________ Objednatel</p>
        `;

        document.getElementById("smlouvaFinalHTML").innerHTML = smlouvaHTML;
        document.getElementById("vystupSmlouvy").classList.remove("hidden");
        window.scrollTo({ top: document.getElementById("vystupSmlouvy").offsetTop, behavior: "smooth" });
      });
    });

    function zpetNaHlavni() {
      window.location.href = "index.html";
    }

    function dalsiKrok(stranka) {
      window.location.href = stranka;
    }

    function stahnoutPDF() {
      const element = document.getElementById("smlouvaFinalHTML");
      html2pdf().set({ margin: 10, filename: 'pracovni_smlouva.pdf', html2canvas: { scale: 2 }, jsPDF: { unit: 'mm', format: 'a4' } })
                .from(element)
                .save();
    }

    function odeslatEmailem() {
      const email = document.getElementById("email").value;
      if (!email) {
        alert("Zadejte e-mailovou adresu.");
        return;
      }
      const text = document.getElementById("smlouvaFinalHTML").innerText;
      const subject = encodeURIComponent("Pracovn√≠ smlouva");
      const body = encodeURIComponent(text);
      window.location.href = `mailto:${email}?subject=${subject}&body=${body}`;
    }
  </script>
</body>
</html>
